#!/bin/bash

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/../../.." && pwd)"
source "$SCRIPT_DIR/config.sh"

clear
echo -e "${CYAN}${BOLD}ğŸ§  Lesson: 'uptime' â€” System Uptime and Load${RESET}"
echo
echo -e "The ${YELLOW}uptime${RESET} command tells you:"
echo -e "  - How long the system has been running"
echo -e "  - How many users are currently logged in"
echo -e "  - The system load averages (1, 5, 15 minutes)"
echo
echo -e "${BOLD}ğŸ“Œ Syntax:${RESET}"
echo -e "  ${GREEN}uptime${RESET}"
pause

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo -e "${CYAN}${BOLD}ğŸ” Example Output:${RESET}"
echo -e "  ${GREEN}$(uptime)${RESET}"
echo
echo -e "${YELLOW}Load Average:${RESET} These numbers represent how busy your CPU(s) are."
echo -e "  - A value of 1.00 means full usage of a single CPU core."
echo -e "  - On a 4-core CPU, a load of 4.00 means full usage."
pause

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TMPDIR="$HOME/.mr_linux_uptime_lesson"
mkdir -p "$TMPDIR"
cd "$TMPDIR" || exit 1

ask_and_check() {
    local description="$1"
    local hint="$2"
    local regex="$3"
    local success_msg="$4"

    while true; do
        echo
        echo -e "${CYAN}${BOLD}ğŸ§ª TASK: $description${RESET}"
        [[ -n "$hint" ]] && echo -e "${YELLOW}ğŸ’¡ Hint: $hint${RESET}"
        read -rp "ğŸ’» Type your command: " user_cmd

        if [[ "$user_cmd" =~ $regex ]]; then
            echo -e "${GREEN}âœ… $success_msg${RESET}"
            break
        else
            echo -e "${RED}âŒ Incorrect. Try again!${RESET}"
        fi
    done
    pause
    clear
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ask_and_check \
    "Check how long the system has been running" \
    "Just use the command on its own." \
    '^uptime\s*$' \
    "Perfect! That's your system's uptime and load info."

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo -e "${CYAN}${BOLD}ğŸ’¡ Bonus Tip:${RESET}"
echo -e "You can also get load averages from:"
echo -e "  ${YELLOW}cat /proc/loadavg${RESET}"
echo -e "Or use ${YELLOW}w${RESET} to see uptime and who is logged in."
pause

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo -e "${CYAN}${BOLD}ğŸ§¼ Cleaning up...${RESET}"
rm -rf "$TMPDIR"

echo -e "${GREEN}${BOLD}ğŸ‰ Lesson Complete!${RESET}"
echo "You've mastered the ${YELLOW}uptime${RESET} command."
pause
